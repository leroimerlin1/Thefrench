<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>The French Cali Farmz</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap');

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Orbitron', sans-serif;
      background:#000;
      color:#e0ffe0;
      min-height:100vh;
      overflow-x:hidden;
    }
    .container {
      position:relative;
      min-height:100vh;
      background:url('https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') center/cover no-repeat fixed;
    }
    .overlay {
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.78);
      backdrop-filter:blur(1.5px);
      z-index:1;
    }
    .content {
      position:relative;
      z-index:2;
      min-height:100vh;
    }

    header {
      position:sticky;
      top:0;
      background:rgba(0,0,0,0.75);
      backdrop-filter:blur(10px);
      padding:10px 16px;
      border-bottom:1px solid rgba(57,255,20,0.35);
      z-index:10;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .back-btn {
      background:rgba(57,255,20,0.15);
      color:#39ff14;
      border:1px solid #39ff14;
      padding:8px 14px;
      border-radius:8px;
      font-weight:bold;
      cursor:pointer;
    }
    h1 {
      font-size:1.35rem;
      font-weight:900;
      letter-spacing:1.5px;
      color:#39ff14;
      text-shadow:0 0 12px rgba(57,255,20,0.7);
    }

    .welcome {
      padding:18px 16px;
      background:linear-gradient(to right, rgba(0,0,0,0.65), rgba(10,50,10,0.35));
      border-bottom:1px solid rgba(57,255,20,0.25);
    }
    .welcome-inner {
      display:flex;
      align-items:center;
      gap:14px;
    }
    .welcome-emoji {
      width:52px;
      height:52px;
      border-radius:50%;
      background:rgba(57,255,20,0.12);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:2rem;
      box-shadow:0 0 16px rgba(57,255,20,0.35);
    }

    .filters {
      padding:10px 16px;
      display:flex;
      gap:10px;
      background:rgba(0,0,0,0.45);
      border-bottom:1px solid rgba(57,255,20,0.2);
    }
    .filter-btn {
      flex:1;
      padding:10px;
      background:rgba(57,255,20,0.15);
      border:1px solid #39ff14;
      border-radius:8px;
      color:#39ff14;
      font-weight:bold;
      cursor:pointer;
      text-align:center;
      transition:0.2s;
    }
    .filter-btn.active {
      background:#39ff14;
      color:#000;
    }

    #products-grid {
      padding:16px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:14px;
      padding-bottom:90px;
    }
    .card {
      background:rgba(15,25,15,0.65);
      border:1px solid rgba(57,255,20,0.35);
      border-radius:10px;
      overflow:hidden;
      backdrop-filter:blur(5px);
      transition:all 0.2s;
      cursor:pointer;
    }
    .card:hover { transform:scale(1.03); border-color:#39ff14; }
    .card-img { height:170px; position:relative; }
    .card-img img { width:100%; height:100%; object-fit:cover; }
    .badge-star {
      position:absolute; top:6px; left:6px;
      background:#39ff14; color:#000; font-size:0.65rem; padding:3px 8px; border-radius:999px; font-weight:bold;
    }
    .badge-farm {
      position:absolute; bottom:6px; right:6px;
      background:rgba(0,0,0,0.75); color:#39ff14; font-size:0.7rem; padding:4px 9px; border-radius:6px;
    }
    .card-body { padding:10px; }
    .card-title { font-size:1rem; color:#fff; margin-bottom:3px; font-weight:700; }
    .card-info { font-size:0.75rem; color:#aaffaa; }

    #category-list, #farm-list {
      display:none;
      padding:16px;
      padding-bottom:100px;
    }
    .list-item {
      background:rgba(15,25,15,0.7);
      border:1px solid rgba(57,255,20,0.4);
      border-radius:10px;
      padding:16px;
      margin-bottom:12px;
      cursor:pointer;
      font-size:1.1rem;
      font-weight:bold;
      transition:0.2s;
    }
    .list-item:hover {
      background:#39ff14;
      color:#000;
      transform:translateX(6px);
    }

    #product-detail { display:none; padding:0 0 100px 0; }
    .product-hero { height:260px; position:relative; }
    .product-hero img { width:100%; height:100%; object-fit:cover; }
    .product-title { padding:16px; font-size:1.5rem; font-weight:900; color:#39ff14; text-shadow:0 0 10px rgba(57,255,20,0.6); }
    .badges { padding:0 16px 12px; display:flex; flex-wrap:wrap; gap:8px; }
    .badge { padding:6px 12px; border-radius:999px; font-size:0.85rem; font-weight:bold; }
    .badge-strain { background:rgba(57,255,20,0.2); color:#39ff14; border:1px solid #39ff14; }
    .badge-farm { background:rgba(0,80,0,0.4); color:#aaffaa; border:1px solid #39ff14; }
    .info-diamond { padding:0 16px 16px; color:#39ff14; font-size:0.9rem; }
    .quantity-section { padding:16px; background:rgba(0,0,0,0.5); margin:12px 16px; border-radius:12px; border:1px solid rgba(57,255,20,0.4); }
    .quantity-title { font-size:1.1rem; color:#39ff14; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
    .quantity-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
    .qty-btn {
      background:rgba(57,255,20,0.15); border:1px solid #39ff14; color:#fff;
      padding:12px 8px; border-radius:10px; text-align:center; cursor:pointer; font-weight:bold; transition:0.2s; line-height:1.3;
    }
    .qty-btn:hover, .qty-btn.selected { background:#39ff14; color:#000; }
    .add-to-cart {
      margin:16px; background:#39ff14; color:#000; border:none; padding:16px; font-size:1.1rem; font-weight:bold;
      border-radius:12px; display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer;
      box-shadow:0 0 15px rgba(57,255,20,0.5);
    }

    #cart-page { display:none; padding:16px; padding-bottom:120px; }
    .cart-item {
      background:rgba(15,25,15,0.65);
      border:1px solid rgba(57,255,20,0.35);
      border-radius:10px;
      padding:12px;
      margin-bottom:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .cart-item-name { font-size:1rem; color:#fff; }
    .cart-item-qty { color:#39ff14; font-weight:bold; }
    .questionnaire { margin-top:24px; }
    .question { margin-bottom:20px; }
    .question-label { font-size:1.1rem; color:#39ff14; margin-bottom:10px; display:block; }
    .option-btn {
      background:rgba(57,255,20,0.15);
      border:1px solid #39ff14;
      color:#fff;
      padding:12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:bold;
      width:100%;
      margin-bottom:8px;
      text-align:center;
    }
    .option-btn.selected { background:#39ff14; color:#000; }
    input, textarea {
      background:rgba(0,0,0,0.5);
      border:1px solid #39ff14;
      color:#fff;
      padding:12px;
      border-radius:10px;
      width:100%;
      margin-bottom:12px;
      font-family:inherit;
    }
    .submit-order {
      background:#39ff14;
      color:#000;
      border:none;
      padding:16px;
      font-size:1.1rem;
      font-weight:bold;
      border-radius:12px;
      cursor:pointer;
      width:100%;
      box-shadow:0 0 15px rgba(57,255,20,0.5);
    }

    nav {
      position:fixed;
      bottom:0;
      left:0; right:0;
      background:rgba(5,15,5,0.92);
      backdrop-filter:blur(14px);
      border-top:1px solid rgba(57,255,20,0.25);
      padding:8px 0;
      display:flex;
      justify-content:space-around;
      z-index:20;
    }
    .nav-item {
      display:flex;
      flex-direction:column;
      align-items:center;
      color:#88ff88;
      font-size:0.7rem;
      gap:3px;
      cursor:pointer;
    }
    .nav-item.active { color:#39ff14; }
  </style>
</head>
<body>

<div class="container">
  <div class="overlay"></div>
  <div class="content">

    <header id="main-header">
      <button class="back-btn" id="btn-back" style="display:none;">‚Üê Retour</button>
      <h1 id="page-title">The French Cali Farmz</h1>
      <div id="user-info"></div>
    </header>

    <div id="home-page">
      <section class="welcome">
        <div class="welcome-inner">
          <div class="welcome-emoji">üëã</div>
          <div>
            <h2 id="welcome-name">Chargement...</h2>
            <p>Bienvenue sur le shop premium</p>
          </div>
        </div>
      </section>

      <div class="filters">
        <button class="filter-btn" id="btn-categories">Cat√©gories</button>
        <button class="filter-btn" id="btn-farms">Farms</button>
      </div>

      <div id="products-grid">
        <div class="card" data-key="cali">
          <div class="card-img">
            <img src="caliplates.jpg" alt="Caliplates">
            <div class="badge-star">‚òÖ</div>
            <div class="badge-farm">Frozen Single Source üá∫üá∏</div>
          </div>
          <div class="card-body">
            <div class="card-title">Caliplatesüá∫üá∏</div>
            <div class="card-info">Frozen Single Source üá∫üá∏</div>
          </div>
        </div>

        <div class="card" data-key="35u">
          <div class="card-img">
            <img src="35u.jpg" alt="35u KGF">
            <div class="badge-star">‚òÖ</div>
            <div class="badge-farm">KGF ü¶ä</div>
          </div>
          <div class="card-body">
            <div class="card-title">35u KGFü¶ä</div>
            <div class="card-info">KGF ü¶ä</div>
          </div>
        </div>
      </div>

      <div id="category-list"></div>
      <div id="farm-list"></div>
    </div>

    <div id="product-detail" style="display:none;">
      <div class="product-hero"><img id="detail-img" src="" alt="Produit"></div>
      <div class="product-title" id="detail-title"></div>
      <div class="badges">
        <div class="badge badge-strain" id="detail-strain"></div>
        <div class="badge badge-farm" id="detail-farm"></div>
      </div>
      <div class="info-diamond" id="detail-info"></div>
      <div class="quantity-section">
        <div class="quantity-title"><span>üõçÔ∏è</span> S√©lectionner la Quantit√©</div>
        <div class="quantity-grid" id="qty-grid"></div>
      </div>
      <button class="add-to-cart" id="add-to-cart-btn"><span>üõí</span> Ajouter au Panier</button>
    </div>

    <div id="cart-page" style="display:none;">
      <div id="cart-items"></div>
      <div class="questionnaire" id="questionnaire" style="display:none;">
        <div class="question">
          <span class="question-label">Venir sur place ou Livr√© ?</span>
          <button class="option-btn" data-type="pickup">Venir sur place</button>
          <button class="option-btn" data-type="delivery">Livr√©</button>
        </div>

        <div id="pickup-questions" style="display:none;">
          <div class="question">
            <span class="question-label">Pour quelle heure ?</span>
            <input type="time" id="pickup-time">
          </div>
        </div>

        <div id="delivery-questions" style="display:none;">
          <div class="question">
            <span class="question-label">Pour quelle heure ?</span>
            <input type="time" id="delivery-time">
          </div>
          <div class="question">
            <span class="question-label">Votre adresse :</span>
            <input type="text" id="delivery-address" placeholder="Adresse compl√®te">
          </div>
          <div class="question">
            <span class="question-label">D√©tails / questions livraison :</span>
            <textarea id="delivery-details" placeholder="Pr√©cisez ici..."></textarea>
          </div>
        </div>

        <button class="submit-order" id="submit-order-btn">Commander</button>
      </div>
    </div>

    <nav>
      <div class="nav-item active" id="nav-home">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>Accueil</span>
      </div>
      <div class="nav-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        <span>Avis</span>
      </div>
      <div class="nav-item" id="nav-cart">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <span>Panier</span>
      </div>
      <div class="nav-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
        <span>Infos</span>
      </div>
      <div class="nav-item">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>Contact</span>
      </div>
    </nav>

  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  const user = tg.initDataUnsafe?.user;
  if (user) {
    document.getElementById('welcome-name').textContent = `Salut ${user.first_name || 'Farmer'} !`;
    document.getElementById('user-info').textContent = `@${user.username || 'anonyme'}`;
  } else {
    document.getElementById('welcome-name').textContent = 'Bienvenue !';
  }

  const products = {
    cali: {
      key: 'cali',
      title: 'Caliplatesüá∫üá∏',
      farm: 'Frozen Single Source üá∫üá∏',
      img: 'caliplates.jpg',
      strain: 'Frozen Single Source üá∫üá∏',
      info: '‚óÜ frozen single source üá∫üá∏',
      quantities: [
        { qty: '0.5g', price: '40 ‚Ç¨' },
        { qty: '1g', price: '80 ‚Ç¨' },
        { qty: '2g', price: '130 ‚Ç¨' },
        { qty: '5g', price: '280 ‚Ç¨' },
        { qty: '10g', price: '500 ‚Ç¨' },
        { qty: '20g', price: '950 ‚Ç¨' }
      ]
    },
    '35u': {
      key: '35u',
      title: '35u KGFü¶ä',
      farm: 'KGF ü¶ä',
      img: '35u.jpg',
      strain: 'KGF ü¶ä',
      info: '‚óÜ KGF ü¶ä',
      quantities: [
        { qty: '5g', price: '30 ‚Ç¨' },
        { qty: '10g', price: '60 ‚Ç¨' },
        { qty: '25g', price: '100 ‚Ç¨' },
        { qty: '50g', price: '180 ‚Ç¨' },
        { qty: '100g', price: '350 ‚Ç¨' },
        { qty: '500g', price: '1600 ‚Ç¨' },
        { qty: '1000g', price: '3200 ‚Ç¨' }
      ]
    }
  };

  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // OUVRIR D√âTAIL PRODUIT
  function openProductDetail(key) {
    const p = products[key];
    if (!p) return;

    document.getElementById('detail-img').src = p.img;
    document.getElementById('detail-title').textContent = p.title;
    document.getElementById('detail-strain').textContent = p.strain;
    document.getElementById('detail-farm').textContent = p.farm;
    document.getElementById('detail-info').textContent = p.info;

    const grid = document.getElementById('qty-grid');
    grid.innerHTML = '';
    p.quantities.forEach((item, idx) => {
      const btn = document.createElement('button');
      btn.className = 'qty-btn';
      btn.innerHTML = `${item.qty}<br>${item.price}`;
      btn.onclick = () => {
        grid.querySelectorAll('.qty-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
      };
      grid.appendChild(btn);
    });

    document.getElementById('home-page').style.display = 'none';
    document.getElementById('product-detail').style.display = 'block';
    document.getElementById('btn-back').style.display = 'inline-block';
    document.getElementById('page-title').textContent = p.title;
  }

  // Clic carte produit grille
  document.querySelectorAll('#products-grid .card').forEach(card => {
    card.addEventListener('click', () => openProductDetail(card.dataset.key));
  });

  // Bouton Retour g√©n√©ral
  document.getElementById('btn-back').onclick = () => {
    document.getElementById('home-page').style.display = 'block';
    document.getElementById('product-detail').style.display = 'none';
    document.getElementById('cart-page').style.display = 'none';
    document.getElementById('category-list').style.display = 'none';
    document.getElementById('farm-list').style.display = 'none';
    document.getElementById('products-grid').style.display = 'grid';
    document.getElementById('btn-back').style.display = 'none';
    document.getElementById('page-title').textContent = 'The French Cali Farmz';
    document.getElementById('btn-categories').classList.remove('active');
    document.getElementById('btn-farms').classList.remove('active');
  };

  // FILTRE CAT√âGORIES ‚Üí liste titres
  document.getElementById('btn-categories').onclick = function() {
    this.classList.toggle('active');
    document.getElementById('btn-farms').classList.remove('active');

    if (this.classList.contains('active')) {
      document.getElementById('products-grid').style.display = 'none';
      document.getElementById('farm-list').style.display = 'none';
      document.getElementById('category-list').style.display = 'block';
      document.getElementById('category-list').innerHTML = '';

      Object.keys(products).forEach(key => {
        const p = products[key];
        const div = document.createElement('div');
        div.className = 'list-item';
        div.textContent = p.title;
        div.onclick = () => openProductDetail(key);
        document.getElementById('category-list').appendChild(div);
      });
    } else {
      document.getElementById('category-list').style.display = 'none';
      document.getElementById('products-grid').style.display = 'grid';
    }
  };

  // FILTRE FARMS ‚Üí liste farms/sous-titres
  document.getElementById('btn-farms').onclick = function() {
    this.classList.toggle('active');
    document.getElementById('btn-categories').classList.remove('active');

    if (this.classList.contains('active')) {
      document.getElementById('products-grid').style.display = 'none';
      document.getElementById('category-list').style.display = 'none';
      document.getElementById('farm-list').style.display = 'block';
      document.getElementById('farm-list').innerHTML = '';

      Object.keys(products).forEach(key => {
        const p = products[key];
        const div = document.createElement('div');
        div.className = 'list-item';
        div.textContent = p.farm;
        div.onclick = () => openProductDetail(key);
        document.getElementById('farm-list').appendChild(div);
      });
    } else {
      document.getElementById('farm-list').style.display = 'none';
      document.getElementById('products-grid').style.display = 'grid';
    }
  };

  // AJOUTER AU PANIER
  document.getElementById('add-to-cart-btn').onclick = () => {
    const selected = document.querySelector('.qty-btn.selected');
    if (!selected) return alert('S√©lectionnez une quantit√© !');

    const key = document.querySelector('#detail-title').textContent.includes('Caliplates') ? 'cali' : '35u';
    const p = products[key];
    const idx = selected.dataset.index || Array.from(document.querySelectorAll('.qty-btn')).indexOf(selected);
    const item = p.quantities[idx];

    cart.push({
      title: p.title,
      qty: item.qty,
      price: item.price
    });

    localStorage.setItem('cart', JSON.stringify(cart));
    alert('Ajout√© au panier !');
  };

  // OUVRIR PANIER
  document.getElementById('nav-cart').onclick = () => {
    document.getElementById('home-page').style.display = 'none';
    document.getElementById('product-detail').style.display = 'none';
    document.getElementById('category-list').style.display = 'none';
    document.getElementById('farm-list').style.display = 'none';
    document.getElementById('cart-page').style.display = 'block';
    document.getElementById('btn-back').style.display = 'inline-block';
    document.getElementById('page-title').textContent = 'Panier';

    const itemsDiv = document.getElementById('cart-items');
    itemsDiv.innerHTML = '';

    if (cart.length === 0) {
      itemsDiv.innerHTML = '<p style="text-align:center; color:#888; padding:40px 0;">Votre panier est vide</p>';
      document.getElementById('questionnaire').style.display = 'none';
    } else {
      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `<span class="cart-item-name">${item.title}</span><span class="cart-item-qty">${item.qty} - ${item.price}</span>`;
        itemsDiv.appendChild(div);
      });
      document.getElementById('questionnaire').style.display = 'block';
    }
  };

  // QUESTIONNAIRE LIVRAISON / SUR PLACE
  let deliveryType = '';
  document.querySelectorAll('.option-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      deliveryType = btn.dataset.type;

      document.getElementById('pickup-questions').style.display = deliveryType === 'pickup' ? 'block' : 'none';
      document.getElementById('delivery-questions').style.display = deliveryType === 'delivery' ? 'block' : 'none';
    };
  });

  // COMMANDER ‚Üí message Telegram
  document.getElementById('submit-order-btn').onclick = () => {
    if (!deliveryType) return alert('Choisissez un mode de r√©cup√©ration !');

    let message = 'NOUVELLE COMMANDE\n\n';
    cart.forEach(item => {
      message += `‚Ä¢ ${item.title} : ${item.qty} (${item.price})\n`;
    });

    if (deliveryType === 'pickup') {
      const time = document.getElementById('pickup-time').value;
      if (!time) return alert('Indiquez une heure !');
      message += `\nMode : Venir sur place\nHeure : ${time}`;
    } else {
      const time = document.getElementById('delivery-time').value;
      const addr = document.getElementById('delivery-address').value;
      const details = document.getElementById('delivery-details').value;
      if (!time || !addr) return alert('Heure et adresse obligatoires !');
      message += `\nMode : Livraison\nHeure : ${time}\nAdresse : ${addr}\nD√©tails : ${details || 'aucun'}`;
    }

    const encoded = encodeURIComponent(message);
    tg.openTelegramLink(`https://t.me/orderthefrenchcalifarmz26?text=${encoded}`);

    // Reset panier
    cart = [];
    localStorage.setItem('cart', JSON.stringify(cart));
    alert('Commande envoy√©e ! Panier vid√©.');
  };
</script>

</body>
</html>
